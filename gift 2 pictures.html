<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>pictures</title> <!-- tab title only -->
  <meta name="description" content="A giant photo with a segment music player." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-paper">
  <main class="wrap">

    <!-- GIANT PHOTO -->
    <figure class="giant-photo card" style="margin:0">
      <img
        src="https://i.pinimg.com/736x/b6/5a/7d/b65a7d9c9d1afedc9f13420912726e63.jpg"
        alt="Big memory photo"
        class="giant-img"
        width="1600" height="1000"
      />
    </figure> 
    
      <!-- Custom Player overlay -->
      <div class="player" role="group" aria-label="Music controls">
        <button id="pp" class="btn btn-pill btn-accent" type="button" aria-label="Play / Pause">‚ñ∂ Play</button>

        <span id="tcur" class="time">0:00</span>
        <input id="seek" class="seek" type="range" min="0" max="1" step="0.01" value="0" aria-label="Seek within clip">
        <span id="tlen" class="time">0:00</span>

        <button id="mute" class="btn btn-pill" type="button" aria-pressed="false" aria-label="Mute / Unmute">üîä</button>
        <input id="vol" class="vol" type="range" min="0" max="1" step="0.01" value="0.9" aria-label="Volume">
        <!-- Hidden native audio element -->
        <audio
          id="song"
          preload="metadata"
          src="https://drive.google.com/uc?export=download&id=19Tm5z9ikPO9fyH6rNjtKJQCbLNfDZo8t">
        </audio>
      </div>
    
      

  </main>

  <!-- Back to 3 gifts -->
  <a class="fab-back" href="yes.html" aria-label="Back to gifts">‚Üê</a>

<script>
  const song = document.getElementById('song');
  const pp   = document.getElementById('pp');
  const seek = document.getElementById('seek');
  const tcur = document.getElementById('tcur');
  const tlen = document.getElementById('tlen');
  const mute = document.getElementById('mute');
  const vol  = document.getElementById('vol');

  let userVol = parseFloat(vol.value);
  let fadeTimer = null;

  const fmt = s => {
    s = Math.max(0, Math.floor(s));
    const m = Math.floor(s/60);
    const ss = String(s % 60).padStart(2,'0');
    return `${m}:${ss}`;
  };

  function setBtnPlaying(isPlaying){
    pp.textContent = isPlaying ? '‚è∏ Pause' : '‚ñ∂ Play';
  }

  function applyVolume(target, ms=0){
    const base = userVol;
    const from = song.volume;
    const to = Math.min(1, Math.max(0, base * target));
    if (fadeTimer) cancelAnimationFrame(fadeTimer);
    if (ms <= 0){ song.volume = to; return; }
    const t0 = performance.now();
    const step = () => {
      const p = Math.min(1, (performance.now()-t0)/ms);
      song.volume = from + (to-from)*p;
      if (p < 1) fadeTimer = requestAnimationFrame(step);
    };
    fadeTimer = requestAnimationFrame(step);
  }

  function updateTimeUI(){
    const dur = song.duration || 0;
    const pos = song.currentTime;

    tcur.textContent = fmt(pos);
    tlen.textContent = fmt(dur);

    seek.value = dur ? (pos / dur).toFixed(3) : 0;
  }

  async function ensureMetadata(){
    if (song.readyState >= 1) return;
    await new Promise(res => song.addEventListener('loadedmetadata', res, { once: true }));
  }

  function playFromStart(){
    song.currentTime = 0;
    setBtnPlaying(true);
    song.play().catch(()=>{});
    applyVolume(0, 0);
    applyVolume(1, 220);
  }

  // Play/pause button
  pp.addEventListener('click', async () => {
    if (song.paused){
      await ensureMetadata();
      playFromStart();
    } else {
      song.pause();
      setBtnPlaying(false);
    }
  });

  // NORMAL playback ‚Äî no segment clipping, no forced looping
  song.addEventListener('timeupdate', updateTimeUI);

  // Seek bar (0‚Äì100%)
  seek.addEventListener('input', () => {
    const dur = song.duration;
    if (dur) {
      song.currentTime = parseFloat(seek.value) * dur;
    }
  });

  // Mute / volume
  mute.addEventListener('click', () => {
    const pressed = mute.getAttribute('aria-pressed') === 'true';
    if (pressed){
      mute.setAttribute('aria-pressed','false');
      mute.textContent = 'üîä';
      userVol = parseFloat(vol.value);
    } else {
      mute.setAttribute('aria-pressed','true');
      mute.textContent = 'üîá';
      userVol = 0;
    }
    song.volume = userVol;
  });

  vol.addEventListener('input', () => {
    userVol = parseFloat(vol.value);
    song.volume = userVol;
  });

  song.addEventListener('loadedmetadata', updateTimeUI);

  song.addEventListener('ended', () => setBtnPlaying(false));
  </script>
</body>
</html>
